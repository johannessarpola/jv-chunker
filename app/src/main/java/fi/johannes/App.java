/*
 * This source file was generated by the Gradle 'init' task
 */
package fi.johannes;

import java.io.IOException;
import java.nio.file.Path;
import java.util.Collection;
import java.util.List;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.Executors;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import static java.lang.System.exit;

public class App {
    public static void main(String[] args) throws IOException {
        long statTime = System.currentTimeMillis();

        var cli = new ChunkyBoyoCli(args);
        var conf = cli.asConfiguration();
        var ec = Executors.newFixedThreadPool(10);
        var sb = ReaderBoyo.builder()
                .config(conf)
                .threadPoolExecutor(ec)
                .build();

        var cf = FutureUtils.callableToCompletable(sb, ec);

        cf.join().getResult().forEach(listCompletableFuture -> listCompletableFuture.join().forEach(pathWriterWrapper -> pathWriterWrapper.getFuture().join()));

        Printer.println("Took %d ms", System.currentTimeMillis() - statTime);

        exit(0);

    }


}
